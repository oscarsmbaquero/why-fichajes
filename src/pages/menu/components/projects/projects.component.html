<div class="container-fluid my-4">
  <div class="row justify-content-center">
    <div class="col-12 col-md-10">
      <div class="table-responsive">
        <table
          class="table table-bordered table-striped align-middle text-center"
        >
          <thead class="table-light">
            <tr>
              <th>Nombre</th>
              <!-- <th>Ubicación</th> -->
              <th>Descripción</th>
              <th>Horas</th>
              <!-- <th>Ubicación</th> -->
            </tr>
          </thead>
          <tbody>
            @for (user of projects; track user._id) {
            <tr (click)="toggleExpand(user._id)" style="cursor: pointer">
              <td>
                {{ user.nombre }}
                @if(user.tareas && user.tareas.length > 0){
                <span class="badge bg-info" style="color: black"
                  >{{ user.tareas.length }} Tareas</span
                >
                }@else {
                <span (click)="agregarTarea(user)" class="badge bg-secondary"
                  >Añadir tareas</span
                >
                }
              </td>
              <td>{{ user.descripcion }}</td>
              <td>{{ user.horas }}</td>
              <!-- <td>{{ user.hours }}</td> -->
            </tr>
            @if (expandedIndex === user._id) {
            <tr>
              <td
                colspan="3"
                style="
                  background-color: white !important;
                  padding: 0 !important;
                "
              >
                <table style="width: 100%; border-collapse: collapse">
                  <thead>
                    <tr style="background-color: #f5f5f5">
                      <th
                        class="sub-table"
                        style="padding: 0.5rem; text-align: center"
                      >
                        Nombre
                      </th>
                      <th
                        class="sub-table"
                        style="padding: 0.5rem; text-align: center"
                      >
                        Horas
                      </th>
                      <th
                        class="sub-table"
                        style="padding: 0.5rem; text-align: center"
                      >
                        Estimación
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (item of user.tareas; track $index) {
                    <tr [ngClass]="{ 'text-success': item.esVerde, 'text-danger': !item.esVerde }" style="padding: 0.5rem">
                      <td style="padding: 0.5rem">{{ item.nombre }}</td>
                      <td style="padding: 0.5rem">{{ item.horas }}h.</td>
                      <td style="padding: 0.5rem">{{ item.estimacion }}h.</td>
                    </tr>
                    }
                  </tbody>
                </table>
              </td>
            </tr>
            } }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<button (click)="visible = true" class="floating-button">
  <img src="../../../../assets/images/agregar.png" width="50px" />
</button>
<!-- Dialog para añadir proyectos -->
<p-dialog
  header="Añadir Proyecto"
  [modal]="true"
  [(visible)]="visible"
  [style]="{ width: '30rem' }"
  [contentStyle]="{ padding: '2rem' }"
>
  <form
    [formGroup]="projectForm"
    (ngSubmit)="onSubmit()"
    class="d-flex flex-column align-items-center w-100"
  >
    <!-- <span class="text-secondary text-center mb-4">Introduce los detalles del proyecto.</span> -->

    <div class="mb-3 w-100">
      <input
        type="text"
        class="form-control"
        id="nombre"
        formControlName="nombre"
        placeholder="Nombre del proyecto"
      />
    </div>

    <div class="mb-4 w-100">
      <textarea
        class="form-control"
        id="descripcion"
        formControlName="descripcion"
        rows="3"
        placeholder="Descripción del proyecto"
      ></textarea>
    </div>

    <div class="d-flex justify-content-center gap-2 w-100">
      <button type="button" class="btn btn-secondary" (click)="visible = false">
        Cancelar
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="projectForm.invalid"
      >
        Guardar
      </button>
    </div>
  </form>
</p-dialog>
<!--añadir tareas-->
<p-dialog
  header="{{
    projectSelected
      ? 'Añadir Tarea a ' + projectSelected.nombre
      : 'Añadir Tarea'
  }}"
  [modal]="true"
  [(visible)]="addTarea"
  [style]="{ width: '30rem' }"
  [contentStyle]="{ padding: '2rem' }"
>
  <form
    [formGroup]="tareaForm"
    (ngSubmit)="onSubmitTarea()"
    class="d-flex flex-column align-items-center w-100"
  >
    <!-- <span class="text-secondary text-center mb-4">Introduce los detalles del proyecto.</span> -->

    <div class="mb-3 w-100">
      <input
        type="text"
        class="form-control"
        id="nombre"
        formControlName="nombre"
        placeholder="Nombre de la tarea"
      />
    </div>

    <div class="mb-4 w-100">
      <input
        type="number"
        class="form-control"
        id="estimacion"
        formControlName="estimacion"
        placeholder="Estimación de horas"
      />
    </div>

    <div class="d-flex justify-content-center gap-2 w-100">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="addTarea = false"
      >
        Cancelar
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="tareaForm.invalid"
      >
        Guardar
      </button>
    </div>
  </form>
</p-dialog>
